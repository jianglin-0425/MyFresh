<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>天天生鲜-首页</title>
<link rel="short icon" href="images/logo.png">
<link rel="stylesheet" href="css/reset.css">
<link rel="stylesheet" href="css/index.css">
<link rel="stylesheet" href="css/foot.css">
<!--  
<script src="js/jquery-3.4.1.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/slide.js"></script>
注意引入顺序 -->
</head>

<body>
<div id="app">
	<!-- 头部  -->
	<div class="header_con" >
    	<div class="header">
    		<div class="welcome fl">欢迎来到天天生鲜</div>
    		<div class="fr">
            	<div class="login_info fl" v-if="onlogin">
                	欢迎：<em>[{{loginName}}]</em>
                    <a href="" @click="loginOut">退出</a>
                </div>
                <div class="login_btn fl" v-if="outlogin">
                	<a href="login.html">登录</a>
                    <span> | </span>
                    <a href="register.html">注册</a>
                </div>
            	 <div class="user_link fl">
                    <span> | </span>
                    <a href="Menber/userinfomation.html">用户中心</a>
                    <span> | </span>
                    <a href="#" @click="gotoCart()">我的购物车</a>
                    <span> | </span>
                    <a href="#" @click="gotoOrder()">我的订单</a>
           		 </div> 
             </div>  
    	</div>
    </div>
    
     <!-- 搜素框 -->
     <div class="search_bar clearfix">
     		<a href="index.html" class="logo fl"><img src="images/logo.png"></a>
     		<div class="search_con fl">
            	<form>
                    <input type="text" class="input_text fl" name="key_words" placeholder="搜索商品">
                    <input type="submit" class="input_btn fr"  value="搜索">
                </form>
            </div>
     		<div class="guest_cart fr">
            	<a href="#" class="cart_name fl" @click="gotoCart()">我的购物车</a>
                <div class="goods_count fl" id="show_count">{{goodCount}}</div>
            </div>
     </div>

    <!-- 商品分类 -->
    <div class="navbar_con">
    	<div class="navbar">
    		<h1 class="fl">全商品分类</h1>
    		<ul class="navlist fl">
    			<li><a href="">首页</a></li>
                <li class="interval">|</li>
                <li><a href="">手机生鲜</a></li>
                <li class="interval">|</li>
                <li><a href="">抽奖</a></li>
    		</ul>
    	</div>
    </div>
    
    <!-- 导航栏 -->
    <div class="center_con clearfix">
        <div class="subnav fl">
            <ul>
                <li><a href="#model01" class="fruit">新鲜水果</a></li>
                <li><a href="#model02" class="seafood">海鲜水产</a></li>
                <li><a href="#model03" class="meet">猪牛羊肉</a></li>
                <li><a href="#model04" class="egg">禽类蛋品</a></li>
                <li><a href="#model05" class="vegetables">新鲜蔬菜</a></li>
                <li><a href="#model06" class="ice">速冻食品</a></li>
            </ul>
        </div>
        <div class="slide fl">
            <ul class="slide_pics">
                <li><a href="" class=""><img src="images/slide.jpg" alt="幻灯片"></a></li>
                <li><a href="" class=""><img src="images/slide02.jpg" alt="幻灯片"></a></li>
                <li><a href="" class=""><img src="images/slide03.jpg" alt="幻灯片"></a></li>
                <li><a href="" class=""><img src="images/slide04.jpg" alt="幻灯片"></a></li>
            </ul>
            <div class="prev"></div>
            <div class="next"></div>
            <ul class="points"></ul>
        </div>
        <div class="adv fl">
            <a href=""><img src="images/adv01.jpg" alt="清凉一夏"></a>
            <a href=""><img src="images/adv02.jpg" alt="盛夏尝鲜"></a>
        </div>
    </div>
    
    <!-- 商品展示 -->
    <div>
    
    <div class="list_model" v-for="type in types " v-if="type.status==2">
    	<div class="list_title clearfix">
        	<h3 class="fl" id="model01">{{type.tname}}</h3>
        	<div class="subtitle fl">
            	<span>|</span>
                <a :href="'detail.html#'+good.gno" v-for="good in goods" v-if="good.tno==type.tno">{{good.gname}}</a>
            </div>
            <a :href="'goods.html#'+type.tno" class="goods_more fr" id="fruit_more">查看更多</a>
        </div>
    
    	<div class="goods_con clearfix">
        	<div class="goods_banner fl"><img src="images/banner01.jpg"></div>
        	<ul class="goods_list fl">
            	<li v-for="good in goods" v-if="good.tno==type.tno">
                	<h4><a :href="'detail.html#'+good.gno">{{good.gname}}</a></h4>
                    <a :href="'detail.html#'+good.gno"><img :src="good.pics"></a>
                	<div class="prize">￥{{good.price}}</div>
                </li>
            </ul>
        </div>
    </div>
	</div>
</div>
    <!-- 版权所有 -->
    <div class="footer">
    	<div class="foot_link">
        	<a href="#">关于我们</a> <span> | </span>
            <a href="#">联系我们</a> <span> | </span>
            <a href="#">招聘广告</a> <span> | </span>
            <a href="#">友情链接</a>
        </div>
    	<p>CopyRight &copy; 2021 衡阳市J2EE All Rights Reserverd</p>
        <p>电话：110</p>
    </div>
<script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/slide.js"></script>
<script type="text/javascript" src="js/vue.js"></script>
<script type="text/javascript" src="js/axios.js"></script>
<script type="text/javascript">
var vm=new Vue({
	el:'#app',
	data:{
		onlogin:false,
		outlogin:true,
		loginName:'匿名',
		goodCount:0,
		goods:{},
		types:{},
		carts:{},
		detail:{}
	},
	methods:{
		gotoCart:function(){
			if(!this.onlogin){
				window.location.href = 'login.html';
			}else{
				window.location.href = 'cart.html';
				console.log("1123")
			}
		},
		gotoOrder:function(){
			if(!this.onlogin){
				window.location.href = 'login.html';
			}else{
				window.location.href = 'Menber/alOrder.html';
			}
			alert(this.onlogin);
		},
        loginOut:function(){
            axios({
                url:'menber/loginOut',
                method:'post',
            }).then(result=>{
                alert("退出成功");
                window.location.href="login.html"
            })
        }
	},
	mounted:function(){
		axios.all([checkLogin(),getGoodInfo()])
		.then(axios.spread((fn1,fn2)=>{
			console.log(fn1.data);
			console.log(fn2.data);
			if(fn1.data.code){
				this.onlogin=true;
				this.outlogin=false;
				this.loginName=fn1.data.obj.menber.nickname;

				if(fn1.data.obj.carts){
					this.carts=fn1.data.obj.carts;
					this.goodCount=fn1.data.obj.carts.length;
					console.log(fn1.data.obj.carts.length);
				}
			}else{
				this.onlogin=false;
				this.outlogin=true;
			}
			this.goods=fn2.data.obj.goods;
			this.types=fn2.data.obj.types;
			console.log(this.types);
			console.log(this.goods);
		}));
	}
	
});
function checkLogin(){
	return axios.get('menber/check');
}
function getGoodInfo(){
	return axios({
		url:'goods/finds',
		method:'get',
		params:{}
	});
}
</script>
</body>
</html>
